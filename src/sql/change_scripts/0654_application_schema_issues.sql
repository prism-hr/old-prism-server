INSERT INTO USER_ROLE (application_id, user_id, role_id, requesting_user_id, assigned_timestamp)
	SELECT APPLICATION.id, APPLICATION.user_id, "APPLICATION_INTERVIEWEE", ADVERT.user_id, INTERVIEW.created_date
	FROM APPLICATION INNER JOIN ADVERT
		ON APPLICATION.program_id = ADVERT.id
	INNER JOIN INTERVIEW
		ON APPLICATION.latest_interview_id = INTERVIEW.id
	WHERE APPLICATION.state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND APPLICATION.project_id IS NULL
;

INSERT INTO USER_ROLE (application_id, user_id, role_id, requesting_user_id, assigned_timestamp)
	SELECT APPLICATION.id, APPLICATION.user_id, "APPLICATION_INTERVIEWEE", ADVERT.user_id, INTERVIEW.created_date
	FROM APPLICATION INNER JOIN ADVERT
		ON APPLICATION.project_id = ADVERT.id
	INNER JOIN INTERVIEW
		ON APPLICATION.latest_interview_id = INTERVIEW.id
	WHERE APPLICATION.state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
;

INSERT IGNORE INTO USER_ROLE (application_id, user_id, role_id, requesting_user_id, assigned_timestamp)
	SELECT APPLICATION.id, SUPERVISOR.user_id, "APPLICATION_SECONDARY_SUPERVISOR", ADVERT.user_id, APPROVAL_ROUND.created_date
	FROM APPLICATION INNER JOIN ADVERT
		ON APPLICATION.program_id = ADVERT.id
	INNER JOIN APPROVAL_ROUND
		ON APPLICATION.latest_approval_round_id = APPROVAL_ROUND.id
	INNER JOIN SUPERVISOR
		ON APPROVAL_ROUND.id = SUPERVISOR.approval_round_id
	INNER JOIN USER_ROLE
		ON APPLICATION.id = USER_ROLE.application_id
		AND USER_ROLE.role_id = "APPLICATION_PRIMARY_SUPERVISOR"
	WHERE APPLICATION.project_id IS NULL
		AND SUPERVISOR.is_primary = 0
		AND APPLICATION.state_id IN ("APPLICATION_APPROVAL_PENDING_FEEDBACK", "APPLICATION_APPROVAL_PENDING_COMPLETION")
;

INSERT IGNORE INTO USER_ROLE (application_id, user_id, role_id, requesting_user_id, assigned_timestamp)
	SELECT APPLICATION.id, SUPERVISOR.user_id, "APPLICATION_SECONDARY_SUPERVISOR", ADVERT.user_id, APPROVAL_ROUND.created_date
	FROM APPLICATION INNER JOIN ADVERT
		ON APPLICATION.project_id = ADVERT.id
	INNER JOIN APPROVAL_ROUND
		ON APPLICATION.latest_approval_round_id = APPROVAL_ROUND.id
	INNER JOIN SUPERVISOR
		ON APPROVAL_ROUND.id = SUPERVISOR.approval_round_id
	INNER JOIN USER_ROLE
		ON APPLICATION.id = USER_ROLE.application_id
		AND USER_ROLE.role_id = "APPLICATION_PRIMARY_SUPERVISOR"
	WHERE SUPERVISOR.is_primary = 0
		AND APPLICATION.state_id IN ("APPLICATION_APPROVAL_PENDING_FEEDBACK", "APPLICATION_APPROVAL_PENDING_COMPLETION")
;

SET FOREIGN_KEY_CHECKS = 0
;

UPDATE ACTION_TYPE
SET id = REPLACE(id, "RETRACT", "UPDATE")
;

UPDATE ACTION
SET id = REPLACE(id, "RETRACT", "UPDATE"),
	action_type_id = REPLACE(action_type_id, "RETRACT", "UPDATE")
;

UPDATE STATE_ACTION
SET action_id = REPLACE(action_id, "RETRACT", "UPDATE")
;

SET FOREIGN_KEY_CHECKS = 1
;

INSERT INTO STATE_ACTION_NOTIFICATION
	SELECT NULL, id, "APPLICATION_ADMINISTRATOR", 
		"APPLICATION_UPDATE_INTERVIEW_AVAILABILITY_NOTIFICATION"
	FROM STATE_ACTION
	WHERE action_id = "APPLICATION_UPDATE_INTERVIEW_AVAILABILITY"
;

INSERT INTO STATE_ACTION_NOTIFICATION
	SELECT NULL, STATE_ACTION.id, ROLE.id, 
		"APPLICATION_UPDATE_INTERVIEW_AVAILABILITY_NOTIFICATION"
	FROM STATE_ACTION INNER JOIN ROLE
	WHERE STATE_ACTION.action_id = "APPLICATION_UPDATE_INTERVIEW_AVAILABILITY"
		AND ROLE.id IN ("INSTITUTION_ADMINISTRATOR", "PROGRAM_ADMINISTRATOR", 
			"PROJECT_ADMINISTRATOR")
;

INSERT INTO STATE_ACTION_NOTIFICATION
	SELECT NULL, id, "APPLICATION_INTERVIEWEE", 
		"APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS_NOTIFICATION_INTERVIEWEE"
	FROM STATE_ACTION
	WHERE action_id = "APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS"
		UNION
	SELECT NULL, id, "APPLICATION_INTERVIEWER", 
		"APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS_NOTIFICATION_INTERVIEWER"
	FROM STATE_ACTION
	WHERE action_id = "APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS"
;

UPDATE APPLICATION
SET state_id = "APPLICATION_WITHDRAWN_COMPLETED"
WHERE state_id = "APPLICATION_WITHDRAWN_UNSUBMITTED"
;

DELETE FROM STATE
WHERE id = "APPLICATION_WITHDRAWN_UNSUBMITTED"
;

UPDATE ADVERT
SET state_id = "PROGRAM_DISABLED"
WHERE state_id = "PROGRAM_DISABLED_PENDING_COMPLETION"
;

UPDATE STATE_ACTION
SET state_id = "PROGRAM_DISABLED"
WHERE state_id = "PROGRAM_DISABLED_PENDING_COMPLETION"
;

UPDATE STATE_DURATION
SET state_id = "PROGRAM_DISABLED"
WHERE state_id = "PROGRAM_DISABLED_PENDING_COMPLETION"
;

UPDATE ADVERT
SET state_id = "PROJECT_DISABLED"
WHERE state_id = "PROJECT_DISABLED_PENDING_COMPLETION"
;

UPDATE STATE_ACTION
SET state_id = "PROJECT_DISABLED"
WHERE state_id = "PROJECT_DISABLED_PENDING_COMPLETION"
;

UPDATE STATE_DURATION
SET state_id = "PROJECT_DISABLED"
WHERE state_id = "PROJECT_DISABLED_PENDING_COMPLETION"
;

DELETE FROM STATE
WHERE id IN ("PROGRAM_DISABLED_PENDING_COMPLETION", "PROJECT_DISABLED_PENDING_COMPLETION")
;

UPDATE APPLICATION
SET state_id = "APPLICATION_WITHDRAWN"
WHERE state_id = "APPLICATION_WITHDRAWN_PENDING_EXPORT"
;

UPDATE STATE_ACTION
SET state_id = "APPLICATION_WITHDRAWN"
WHERE state_id = "APPLICATION_WITHDRAWN_PENDING_EXPORT"
;

DELETE FROM STATE
WHERE id = "APPLICATION_WITHDRAWN_PENDING_EXPORT"
;

CREATE TABLE STATE_TRANSITION (
	id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
	state_action_id INT(10) UNSIGNED NOT NULL,
	state_transition_type_id VARCHAR(50) NOT NULL,
	transition_state_id VARCHAR(50) NOT NULL,
	display_order INT(3) UNSIGNED,
	PRIMARY KEY (id),
	UNIQUE INDEX (state_action_id, state_transition_type_id, transition_state_id),
	INDEX (state_action_id),
	INDEX (state_transition_type_id),
	INDEX (transition_state_id),
	FOREIGN KEY (state_action_id) REFERENCES STATE_ACTION (id),
	FOREIGN KEY (state_transition_type_id) REFERENCES STATE_TRANSITION_TYPE (id),
	FOREIGN KEY (transition_state_id) REFERENCES STATE (id)
) ENGINE = INNODB
;

CREATE TABLE ROLE_TRANSITION (
	id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
	state_transition_id INT(10) UNSIGNED NOT NULL,
	role_id VARCHAR(50) NOT NULL,
	role_transition_type_id VARCHAR(50) NOT NULL,
	transition_role_id VARCHAR(50),
	PRIMARY KEY (id),
	UNIQUE INDEX (state_transition_id, role_id, role_transition_type_id, transition_role_id),
	INDEX (role_id),
	INDEX (role_transition_type_id),
	INDEX (transition_role_id),
	FOREIGN KEY (state_transition_id) REFERENCES STATE_TRANSITION (id),
	FOREIGN KEY (role_id) REFERENCES ROLE (id),
	FOREIGN KEY (role_transition_type_id) REFERENCES ROLE_TRANSITION_TYPE (id),
	FOREIGN KEY (transition_role_id) REFERENCES ROLE (id)
) ENGINE = INNODB
;

/* Application unsubmitted */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id)
	SELECT id, "ONE_COMPLETED", "APPLICATION_VALIDATION"
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_UNSUBMITTED"
		AND action_id = "APPLICATION_COMPLETE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN_COMPLETED"
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_UNSUBMITTED"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "APPLICATION_UNSUBMITTED_PENDING_COMPLETION"
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_UNSUBMITTED"
		AND action_id = "APPLICATION_ESCALATE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_WITHDRAWN_COMPLETED"
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_UNSUBMITTED"
		AND action_id = "APPLICATION_TERMINATE"
;

/* Application unsubmitted pending completion */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id)
	SELECT id, "ONE_COMPLETED", "APPLICATION_VALIDATION"
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_UNSUBMITTED_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN_COMPLETED"
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_UNSUBMITTED_PENDING_COMPLETION"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_WITHDRAWN_COMPLETED"
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_UNSUBMITTED_PENDING_COMPLETION"
		AND action_id = "APPLICATION_TERMINATE"
;

/* Application validation */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_VALIDATION_PENDING_FEEDBACK", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION"
		AND action_id = "APPLICATION_ASSESS_ELIGIBILITY"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_VALIDATION_PENDING_COMPLETION", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION"
		AND action_id = "APPLICATION_ASSESS_ELIGIBILITY"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION"
		AND action_id = "APPLICATION_TERMINATE"
;

/* Application validation pending feedback */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_VALIDATION_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_CONFIRM_ELIGIBILITY"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_VALIDATION_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_VALIDATION_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_VALIDATION_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_VALIDATION_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 4
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_VALIDATION_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_VALIDATION_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_VALIDATION_PENDING_FEEDBACK"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW",
			"APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
;

/* Application validation pending completion */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_VALIDATION_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_VALIDATION_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_VALIDATION_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_VALIDATION_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 4
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_VALIDATION_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_COMPLETION"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_VALIDATION_PENDING_COMPLETION"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_VALIDATION_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_VALIDATION_PENDING_COMPLETION"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW",
			"APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
;

/* Application review */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW_PENDING_FEEDBACK", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW"
		AND action_id = "APPLICATION_ASSIGN_REVIEWERS"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REVIEWER", "CREATE_ALL", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_ASSIGN_REVIEWERS"
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW"
;

/* Application review pending feedback */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW_PENDING_FEEDBACK", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_PROVIDE_REVIEW"
		UNION
	SELECT id, "ALL_COMPLETED", "APPLICATION_REVIEW_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_PROVIDE_REVIEW"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "APPLICATION_REVIEW_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_ESCALATE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW_PENDING_FEEDBACK", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 4
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REVIEWER", "UPDATE_ONE", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REVIEW"
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND STATE_TRANSITION.state_transition_type_id = "ONE_COMPLETED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", 
		"APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, ROLE.id, "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND ROLE.id IN ("APPLICATION_ADMINISTRATOR", "APPLICATION_REVIEWER")
		UNION
	SELECT STATE_TRANSITION.id, ROLE.id, "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_COMPLETE_REVIEW_STAGE")
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
		AND ROLE.id IN ("APPLICATION_ADMINISTRATOR", "APPLICATION_REVIEWER")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW_PENDING_FEEDBACK"
;

/* Application review pending completion */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_PROVIDE_REVIEW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 4
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REVIEWER", "UPDATE_ONE", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REVIEW"
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		AND STATE_TRANSITION.state_transition_type_id = "ONE_COMPLETED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_REVIEW_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", 
		"APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, ROLE.id, "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_COMPLETE_REVIEW_STAGE")
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
		AND ROLE.id IN ("APPLICATION_ADMINISTRATOR", "APPLICATION_REVIEWER")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_REVIEW_PENDING_COMPLETION"
;

/* Application interview */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_SCHEDULING", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW"
		AND action_id = "APPLICATION_ASSIGN_INTERVIEWERS"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW"
		AND action_id = "APPLICATION_ASSIGN_INTERVIEWERS"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_FEEDBACK", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW"
		AND action_id = "APPLICATION_ASSIGN_INTERVIEWERS"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_POTENTIAL_INTERVIEWEE", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_ASSIGN_INTERVIEWERS"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW"
		AND STATE_TRANSITION.transition_state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_POTENTIAL_INTERVIEWER", "CREATE_ALL", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_ASSIGN_INTERVIEWERS"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW"
		AND STATE_TRANSITION.transition_state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_INTERVIEWEE", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_ASSIGN_INTERVIEWERS"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW"
		AND STATE_TRANSITION.transition_state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_INTERVIEWER", "CREATE_ALL", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_ASSIGN_INTERVIEWERS"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_INTERVIEW_PENDING_INTERVIEW",
			"APPLICATION_INTERVIEW_PENDING_FEEDBACK")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW"
;

/* Application interview pending availability */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_AVAILABILITY", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_PROVIDE_INTERVIEW_AVAILABILITY"		
		UNION
	SELECT id, "ALL_COMPLETED", "APPLICATION_INTERVIEW_PENDING_SCHEDULING", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_PROVIDE_INTERVIEW_AVAILABILITY"	
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "APPLICATION_INTERVIEW_PENDING_SCHEDULING", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_ESCALATE"		
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_INTERVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_FEEDBACK", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 4
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_AVAILABILITY", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", 
			"APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_POTENTIAL_INTERVIEWEE", "UPDATE_ONE", "APPLICATION_INTERVIEWEE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_INTERVIEW_AVAILABILITY"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND STATE_TRANSITION.state_transition_type_id = "ONE_COMPLETED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_POTENTIAL_INTERVIEWER", "UPDATE_ONE", "APPLICATION_INTERVIEWER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_INTERVIEW_AVAILABILITY"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND STATE_TRANSITION.state_transition_type_id = "ONE_COMPLETED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_POTENTIAL_INTERVIEWEE", "UPDATE_ALL", "APPLICATION_INTERVIEWEE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND STATE_TRANSITION.transition_state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		UNION
	SELECT STATE_TRANSITION.id, ROLE.id, "REMOVE_ALL", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND STATE_TRANSITION.transition_state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND ROLE.id IN ("APPLICATION_INTERVIEWEE", "APPLICATION_POTENTIAL_INTERVIEWEE")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_POTENTIAL_INTERVIEWER", "UPDATE_ALL", "APPLICATION_INTERVIEWER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		UNION
	SELECT STATE_TRANSITION.id, ROLE.id, "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_COMPLETE_INTERVIEW_STAGE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND ROLE.id IN ("APPLICATION_ADMINISTRATOR", "APPLICATION_POTENTIAL_INTERVIEWER", "APPLICATION_INTERVIEWER")
		UNION
	SELECT STATE_TRANSITION.id, ROLE.id, "REMOVE_ALL", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_COMPLETE_INTERVIEW_STAGE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
		AND ROLE.id IN ("APPLICATION_POTENTIAL_INTERVIEWEE", "APPLICATION_INTERVIEWEE")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_AVAILABILITY"
;

/* Application interview pending scheduling */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_SCHEDULING", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND action_id = "APPLICATION_PROVIDE_INTERVIEW_AVAILABILITY"		
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_INTERVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND action_id = "APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_FEEDBACK", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND action_id = "APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 4
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_SCHEDULING", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", 
			"APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_POTENTIAL_INTERVIEWEE", "UPDATE_ONE", "APPLICATION_INTERVIEWEE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_INTERVIEW_AVAILABILITY"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND STATE_TRANSITION.state_transition_type_id = "ONE_COMPLETED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_POTENTIAL_INTERVIEWER", "UPDATE_ONE", "APPLICATION_INTERVIEWER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_INTERVIEW_AVAILABILITY"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND STATE_TRANSITION.state_transition_type_id = "ONE_COMPLETED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_POTENTIAL_INTERVIEWEE", "UPDATE_ALL", "APPLICATION_INTERVIEWEE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND STATE_TRANSITION.transition_state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		UNION
	SELECT STATE_TRANSITION.id, ROLE.id, "REMOVE_ALL", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND STATE_TRANSITION.transition_state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND ROLE.id IN ("APPLICATION_INTERVIEWEE", "APPLICATION_POTENTIAL_INTERVIEWEE")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_POTENTIAL_INTERVIEWER", "UPDATE_ALL", "APPLICATION_INTERVIEWER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_INTERVIEW_ARRANGEMENTS"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		UNION
SELECT STATE_TRANSITION.id, ROLE.id, "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_COMPLETE_INTERVIEW_STAGE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND ROLE.id IN ("APPLICATION_ADMINISTRATOR", "APPLICATION_POTENTIAL_INTERVIEWER", "APPLICATION_INTERVIEWER")
		UNION
	SELECT STATE_TRANSITION.id, ROLE.id, "REMOVE_ALL", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_COMPLETE_INTERVIEW_STAGE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
		AND ROLE.id IN ("APPLICATION_POTENTIAL_INTERVIEWEE", "APPLICATION_INTERVIEWEE")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_SCHEDULING"
;

/* Application interview pending interview */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_SCHEDULING", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND action_id = "APPLICATION_UPDATE_INTERVIEW_AVAILABILITY"		
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 4
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_INTERVIEW", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "APPLICATION_INTERVIEW_PENDING_FEEDBACK", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND action_id = "APPLICATION_ESCALATE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_INTERVIEWEE", "REMOVE_ALL", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_ESCALATE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", 
			"APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		UNION
	SELECT STATE_TRANSITION.id, ROLE.id, "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_COMPLETE_INTERVIEW_STAGE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		AND ROLE.id IN ("APPLICATION_ADMINISTRATOR", "APPLICATION_INTERVIEWER")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_INTERVIEWEE", "REMOVE_ALL", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_COMPLETE_INTERVIEW_STAGE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_INTERVIEW"
;

/* Application interview pending feedback */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_FEEDBACK", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_PROVIDE_INTERVIEW_FEEDBACK"		
		UNION
	SELECT id, "ALL_COMPLETED", "APPLICATION_INTERVIEW_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_PROVIDE_INTERVIEW_FEEDBACK"		
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "APPLICATION_INTERVIEW_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_ESCALATE"		
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 4
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_FEEDBACK", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, ROLE.id, "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND ROLE.id IN ("APPLICATION_ADMINISTRATOR", "APPLICATION_INTERVIEWER")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", 
			"APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_INTERVIEWER", "UPDATE_ONE", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_INTERVIEW_FEEDBACK"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		AND STATE_TRANSITION.state_transition_type_id = "ONE_COMPLETED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_WITHDRAW"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_WITHDRAW"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_FEEDBACK"
;

/* Application interview pending completion */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_PROVIDE_INTERVIEW_FEEDBACK"		
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 4
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_INTERVIEW_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", 
			"APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_INTERVIEWER", "UPDATE_ONE", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_INTERVIEW_FEEDBACK"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		AND STATE_TRANSITION.state_transition_type_id = "ONE_COMPLETED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		UNION		
	SELECT STATE_TRANSITION.id, ROLE.id, "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_COMPLETE_INTERVIEW_STAGE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
		AND ROLE.id IN ("APPLICATION_ADMINISTRATOR", "APPLICATION_INTERVIEWER")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_INTERVIEW_PENDING_COMPLETION"
;

/* Application approval */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL_PENDING_FEEDBACK", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL"
		AND action_id = "APPLICATION_ASSIGN_SUPERVISORS"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", "APPLICATION_INTERVIEW")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", "APPLICATION_INTERVIEW")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_PRIMARY_SUPERVISOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_ASSIGN_SUPERVISORS"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_SECONDARY_SUPERVISOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_ASSIGN_SUPERVISORS"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_SECONDARY_SUPERVISOR", "UPDATE_ONE", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_ASSIGN_SUPERVISORS"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_VIEWER_RECRUITER", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_ASSIGN_SUPERVISORS"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL"
;

/* Application approval pending feedback */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL_PENDING_FEEDBACK", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_CONFIRM_PRIMARY_SUPERVISION"
		UNION
	SELECT id, "ALL_COMPLETED", "APPLICATION_APPROVAL_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_CONFIRM_PRIMARY_SUPERVISION"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "APPLICATION_APPROVAL_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_ESCALATE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL_PENDING_FEEDBACK", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_APPROVAL_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_APPROVAL_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_APPROVAL_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_APPROVAL_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 4
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_COMPLETE_APPROVAL_STAGE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_PRIMARY_SUPERVISOR", "UPDATE_ONE", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_PRIMARY_SUPERVISION"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND STATE_TRANSITION.state_transition_type_id = "ONE_COMPLETED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_SECONDARY_SUPERVISOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_PRIMARY_SUPERVISION"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_SECONDARY_SUPERVISOR", "UPDATE_ONE", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_PRIMARY_SUPERVISION"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_APPROVAL_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", 
		"APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, ROLE.id, "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_COMPLETE_APPROVAL_STAGE")
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
		AND ROLE.id IN ("APPLICATION_ADMINISTRATOR", "APPLICATION_PRIMARY_SUPERVISOR")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_FEEDBACK"
;

/* Application approval pending completion */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		AND action_id = "APPLICATION_CONFIRM_PRIMARY_SUPERVISION"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL_PENDING_COMPLETION", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_APPROVAL_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_APPROVAL_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_APPROVAL_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_APPROVAL_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 4
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		AND action_id = "APPLICATION_COMPLETE_APPROVAL_STAGE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_PRIMARY_SUPERVISOR", "UPDATE_ONE", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_PRIMARY_SUPERVISION"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		AND STATE_TRANSITION.state_transition_type_id = "ONE_COMPLETED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_SECONDARY_SUPERVISOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_PRIMARY_SUPERVISION"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_SECONDARY_SUPERVISOR", "UPDATE_ONE", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_PRIMARY_SUPERVISION"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_COMPLETE_APPROVAL_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", 
		"APPLICATION_INTERVIEW", "APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, ROLE.id, "UPDATE_ALL", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	INNER JOIN ROLE
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_COMPLETE_APPROVAL_STAGE")
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
		AND ROLE.id IN ("APPLICATION_ADMINISTRATOR", "APPLICATION_PRIMARY_SUPERVISOR")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE")
		AND STATE_ACTION.state_id = "APPLICATION_APPROVAL_PENDING_COMPLETION"
;

/* Application approved */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVED"
		AND action_id = "APPLICATION_CONFIRM_OFFER_RECOMMENDATION"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVED"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVED"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVED"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVED"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVED"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVED"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVED"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVED"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", "APPLICATION_INTERVIEW", 
			"APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_PRIMARY_SUPERVISOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_OFFER_RECOMMENDATION"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_PRIMARY_SUPERVISOR", "UPDATE_ONE", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_OFFER_RECOMMENDATION"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_SECONDARY_SUPERVISOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_OFFER_RECOMMENDATION"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_SECONDARY_SUPERVISOR", "UPDATE_ONE", "APPLICATION_VIEWER_RECRUITER"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_CONFIRM_OFFER_RECOMMENDATION"
		AND STATE_ACTION.state_id = "APPLICATION_APPROVED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_CONFIRM_OFFER_RECOMMENDATION")
		AND STATE_ACTION.state_id = "APPLICATION_APPROVED"
;

/* Application approved pending export */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "DUE_DATE_EXPIRY", "APPLICATION_APPROVED_COMPLETED", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVED_PENDING_EXPORT"
		AND action_id = "APPLICATION_EXPORT"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "APPLICATION_APPROVED_PENDING_CORRECTION", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVED_PENDING_EXPORT"
		AND action_id = "APPLICATION_EXPORT"
;

/* Application approved pending correction */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id)
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED_PENDING_EXPORT"
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_APPROVED_PENDING_CORRECTION"
		AND action_id = "APPLICATION_CORRECT"
;

/* Application rejected */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REJECTED"
		AND action_id = "APPLICATION_CONFIRM_REJECTION"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REVIEW", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REJECTED"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_INTERVIEW", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REJECTED"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVAL", 2
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REJECTED"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_APPROVED", 3
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REJECTED"
		AND action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REJECTED"
		AND action_id = "APPLICATION_WITHDRAW"
		UNION
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REJECTED"
		AND action_id = "APPLICATION_PROVIDE_REFERENCE"
		UNION
	SELECT id, "PROPAGATION", "APPLICATION_REJECTED_PENDING_EXPORT", NULL
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REJECTED"
		AND action_id = "APPLICATION_TERMINATE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "APPLICATION_ADMINISTRATOR", "CREATE_ONE", NULL
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_MOVE_TO_DIFFERENT_STAGE"
		AND STATE_ACTION.state_id = "APPLICATION_REJECTED"
		AND STATE_TRANSITION.transition_state_id IN ("APPLICATION_REVIEW", "APPLICATION_INTERVIEW", 
			"APPLICATION_APPROVAL")
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ONE", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "APPLICATION_PROVIDE_REFERENCE"
		AND STATE_ACTION.state_id = "APPLICATION_REJECTED"
		UNION
	SELECT STATE_TRANSITION.id, "APPLICATION_REFEREE", "UPDATE_ALL", "APPLICATION_VIEWER_REFEREE"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id IN ("APPLICATION_WITHDRAW", "APPLICATION_TERMINATE", "APPLICATION_CONFIRM_REJECTION")
		AND STATE_ACTION.state_id = "APPLICATION_REJECTED"
;

/* Application rejected pending export */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "DUE_DATE_EXPIRY", "APPLICATION_REJECTED_COMPLETED", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REJECTED_PENDING_EXPORT"
		AND action_id = "APPLICATION_EXPORT"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "APPLICATION_REJECTED_PENDING_CORRECTION", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REJECTED_PENDING_EXPORT"
		AND action_id = "APPLICATION_EXPORT"
;

/* Application rejected pending correction */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id)
	SELECT id, "ONE_COMPLETED", "APPLICATION_REJECTED_PENDING_EXPORT"
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_REJECTED_PENDING_CORRECTION"
		AND action_id = "APPLICATION_CORRECT"
;

/* Application withdrawn pending export */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "DUE_DATE_EXPIRY", "APPLICATION_WITHDRAWN_COMPLETED", 0
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_WITHDRAWN"
		AND action_id = "APPLICATION_EXPORT"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "APPLICATION_WITHDRAWN_PENDING_CORRECTION", 1
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_WITHDRAWN"
		AND action_id = "APPLICATION_EXPORT"
;

/* Application withdrawn pending correction */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id)
	SELECT id, "ONE_COMPLETED", "APPLICATION_WITHDRAWN"
	FROM STATE_ACTION
	WHERE state_id = "APPLICATION_WITHDRAWN_PENDING_CORRECTION"
		AND action_id = "APPLICATION_CORRECT"
;

/* Program approval */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "PROGRAM_APPROVED", 0
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_APPROVAL"
		AND action_id = "PROGRAM_COMPLETE_APPROVAL_STAGE"
		UNION
	SELECT id, "ONE_COMPLETED", "PROGRAM_REJECTED", 1
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_APPROVAL"
		AND action_id = "PROGRAM_COMPLETE_APPROVAL_STAGE"
;

INSERT INTO ROLE_TRANSITION (state_transition_id, role_id, role_transition_type_id, transition_role_id)
	SELECT STATE_TRANSITION.id, "PROGRAM_CREATOR", "UPDATE_ALL", "PROGRAM_ADMINISTRATOR"
	FROM STATE_TRANSITION INNER JOIN STATE_ACTION
		ON STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_ACTION.action_id = "PROGRAM_COMPLETE_APPROVAL_STAGE"
		AND STATE_ACTION.state_id = "PROGRAM_APPROVAL"
		AND STATE_TRANSITION.transition_state_id = "PROGRAM_APPROVED"
;

/* Program approved */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "PROGRAM_DEACTIVATED", 0
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_APPROVED"
		AND action_id = "PROGRAM_CONFIGURE"
		UNION
	SELECT id, "ONE_COMPLETED", "PROGRAM_DISABLED", 1
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_APPROVED"
		AND action_id = "PROGRAM_CONFIGURE"
		UNION
	SELECT id, "ONE_COMPLETED", "PROGRAM_APPROVAL", NULL
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_APPROVED"
		AND action_id = "PROGRAM_CONFIGURE"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "PROGRAM_DISABLED_PENDING_REACTIVATION", NULL
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_APPROVED"
		AND action_id = "PROGRAM_ESCALATE"
;

/* Program deactivated */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "PROGRAM_APPROVED", 0
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_DEACTIVATED"
		AND action_id = "PROGRAM_CONFIGURE"
		UNION
	SELECT id, "ONE_COMPLETED", "PROGRAM_DISABLED", 1
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_DEACTIVATED"
		AND action_id = "PROGRAM_CONFIGURE"
		UNION
	SELECT id, "ONE_COMPLETED", "PROGRAM_APPROVAL", NULL
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_DEACTIVATED"
		AND action_id = "PROGRAM_CONFIGURE"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "PROGRAM_DISABLED_PENDING_REACTIVATION", NULL
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_DEACTIVATED"
		AND action_id = "PROGRAM_ESCALATE"
;

/* Program disabled pending reactivation */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "PROGRAM_APPROVED", 0
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_DISABLED_PENDING_REACTIVATION"
		AND action_id = "PROGRAM_CONFIGURE"
		UNION
	SELECT id, "ONE_COMPLETED", "PROGRAM_DEACTIVATED", 1
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_DISABLED_PENDING_REACTIVATION"
		AND action_id = "PROGRAM_CONFIGURE"
		UNION
	SELECT id, "ONE_COMPLETED", "PROGRAM_APPROVAL", NULL
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_DISABLED_PENDING_REACTIVATION"
		AND action_id = "PROGRAM_CONFIGURE"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "PROGRAM_DISABLED_COMPLETED", NULL
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_DISABLED_PENDING_REACTIVATION"
		AND action_id = "PROGRAM_ESCALATE"
;

/* Program disabled */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id)
	SELECT id, "DUE_DATE_EXPIRY", "PROGRAM_DISABLED_COMPLETED"
	FROM STATE_ACTION
	WHERE state_id = "PROGRAM_DISABLED"
		AND action_id = "PROGRAM_ESCALATE"
;

/* Project approved */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "PROJECT_DEACTIVATED", 0
	FROM STATE_ACTION
	WHERE state_id = "PROJECT_APPROVED"
		AND action_id = "PROJECT_CONFIGURE"
		UNION
	SELECT id, "ONE_COMPLETED", "PROJECT_DISABLED", 1
	FROM STATE_ACTION
	WHERE state_id = "PROJECT_APPROVED"
		AND action_id = "PROJECT_CONFIGURE"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "PROJECT_DISABLED_PENDING_REACTIVATION", NULL
	FROM STATE_ACTION
	WHERE state_id = "PROJECT_APPROVED"
		AND action_id = "PROJECT_ESCALATE"
;

/* Project deactivated */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "PROJECT_APPROVED", 0
	FROM STATE_ACTION
	WHERE state_id = "PROJECT_DEACTIVATED"
		AND action_id = "PROJECT_CONFIGURE"
		UNION
	SELECT id, "ONE_COMPLETED", "PROJECT_DISABLED", 1
	FROM STATE_ACTION
	WHERE state_id = "PROJECT_DEACTIVATED"
		AND action_id = "PROJECT_CONFIGURE"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "PROJECT_DISABLED_PENDING_REACTIVATION", NULL
	FROM STATE_ACTION
	WHERE state_id = "PROJECT_DEACTIVATED"
		AND action_id = "PROJECT_ESCALATE"
;

/* Project disabled pending reactivation */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id, display_order)
	SELECT id, "ONE_COMPLETED", "PROJECT_APPROVED", 0
	FROM STATE_ACTION
	WHERE state_id = "PROJECT_DISABLED_PENDING_REACTIVATION"
		AND action_id = "PROJECT_CONFIGURE"
		UNION
	SELECT id, "ONE_COMPLETED", "PROJECT_DEACTIVATED", 1
	FROM STATE_ACTION
	WHERE state_id = "PROJECT_DISABLED_PENDING_REACTIVATION"
		AND action_id = "PROJECT_CONFIGURE"
		UNION
	SELECT id, "DUE_DATE_EXPIRY", "PROJECT_DISABLED_COMPLETED", NULL
	FROM STATE_ACTION
	WHERE state_id = "PROJECT_DISABLED_PENDING_REACTIVATION"
		AND action_id = "PROJECT_ESCALATE"
;

/* Project disabled */

INSERT INTO STATE_TRANSITION (state_action_id, state_transition_type_id, transition_state_id)
	SELECT id, "DUE_DATE_EXPIRY", "PROJECT_DISABLED_COMPLETED"
	FROM STATE_ACTION
	WHERE state_id = "PROJECT_DISABLED"
		AND action_id = "PROJECT_ESCALATE"
;

UPDATE STATE_TRANSITION
SET display_order = NULL
WHERE state_transition_type_id != "ONE_COMPLETED"
;

CREATE TABLE STATE_TRANSITION_PROPAGATION (
	id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
	state_transition_id INT(10) UNSIGNED NOT NULL,
	propagated_state_transition_id INT(10) UNSIGNED NOT NULL,
	PRIMARY KEY (id),
	UNIQUE INDEX (state_transition_id, propagated_state_transition_id),
	INDEX (propagated_state_transition_id),
	FOREIGN KEY (state_transition_id) REFERENCES STATE_TRANSITION (id),
	FOREIGN KEY (propagated_state_transition_id) REFERENCES STATE_TRANSITION (id)
) ENGINE = INNODB
	SELECT NULL AS id, STATE_TRANSITION.id AS state_transition_id, 
		PROPAGATED_STATE_TRANSITION.id AS propagated_state_transition_id
	FROM STATE_TRANSITION INNER JOIN STATE_TRANSITION AS PROPAGATED_STATE_TRANSITION
	INNER JOIN STATE_ACTION
		ON PROPAGATED_STATE_TRANSITION.state_action_id = STATE_ACTION.id
	WHERE STATE_TRANSITION.transition_state_id IN ("PROGRAM_DISABLED_COMPLETED", "PROJECT_DISABLED_COMPLETED")
		AND STATE_ACTION.action_id = "APPLICATION_TERMINATE"
;

ALTER TABLE ROLE_TRANSITION_TYPE
	ADD COLUMN processing_order INT(1) UNSIGNED,
	ADD INDEX (processing_order)
;

UPDATE ROLE_TRANSITION_TYPE
SET processing_order = 0
WHERE id LIKE "CREATE%"
;

UPDATE ROLE_TRANSITION_TYPE
SET processing_order = 1
WHERE id LIKE "UPDATE%"
;

UPDATE ROLE_TRANSITION_TYPE
SET processing_order = 2
WHERE id LIKE "REMOVE%"
;

ALTER TABLE ROLE_TRANSITION_TYPE
	MODIFY COLUMN processing_order INT(1) UNSIGNED NOT NULL
;

INSERT INTO STATE_DURATION (system_id, institution_id, program_id, state_id, expiry_duration)
	SELECT system_id, institution_id, program_id, "PROGRAM_DISABLED_PENDING_REACTIVATION", expiry_duration
	FROM STATE_DURATION
	WHERE state_id = "PROGRAM_DISABLED"
		UNION
	SELECT system_id, institution_id, program_id, "PROJECT_DISABLED_PENDING_REACTIVATION", expiry_duration
	FROM STATE_DURATION
	WHERE state_id = "PROJECT_DISABLED"
;
